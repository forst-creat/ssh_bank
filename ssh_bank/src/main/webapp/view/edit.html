<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>edit</title>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="../css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}" >
    <link rel="stylesheet" href="../css/bootstrap-table.css" th:href="@{/css/bootstrap-table.css}">

    <style>

        .navbar-default {
            margin-bottom: 0px;
        }

        .list {
            padding-left: 220px;
        }

        .middleMenu {
            z-index: 1;
            width: 100%;
            height: 50px;
            background-color: #faf9f7;
        }

        .middleMenu ul {
            margin-bottom: 0px;
            margin-left: 180px;   /* 去除外边距，使其能够紧贴<div>边缘 */
            padding: 0px;    /* 去除内边距，使其能够紧贴<div>边缘 */
            list-style: none;   /* 去除无序列表的标识符 */
        }

        .middleMenu ul li {
            float: left;
            text-align: center;
            width: 100px;
        }

        .middleMenu ul li a {
            color: #2aabd2;
        }

        .middleMenu ul li a:hover{
            text-align: center;
            width: 100px;
            background-color: #2aabd2;
            border-radius: 8px;
            color: #ffffff;
        }

        a {
            color: #999999;
            display: block; /* 转换为块级元素，为了让点击范围能够扩充到整个<li>区域 */
            line-height: 50px;  /* 设置内边距让文字垂直居中。 */
            text-decoration: none; /* 去除<a>标签的下划线 */
        }

        a:hover {
            display: block; /* 转换为块级元素，为了让点击范围能够扩充到整个<li>区域 */
            text-decoration: none; /* 去除<a>标签的下划线 */
        }

        .btns-group {
            margin: 10px 10px;
        }
        
        .row1 {
        	margin-left: 268px;
            margin-bottom: 10px;
            float: left;
        }

.row2 {
	margin-left: 200px;
	margin-bottom: 10px;
	float: left;
	width: 600px;
}

.rw {
	margin-left: 172px;
	margin-bottom: 10px;
	float: left;
	width: 600px;
}

.dt {
	margin-left: 255px;
	margin-bottom: 10px;
	float: left;
	width: 600px;
}

      .sp {
            display: block;
            float: left;
            padding-right: 20px;
            padding-top: 5px;
            height: 40px;
        }
        
        .pc {
        
       		 margin-right: 50px,
        }
        
	

       .inp {
       		width: 300px;
        	float: left;
        	height: 40px;
        }

        .allContent {
            margin-bottom: 30px;
            margin-left: 10px;
        }
        
.errorMsg1, .errorMsg2, .errorMsg3, .errorMsg4, .spanAttention,.spanAttention1, .errorMsg5, .errorMsg6 {
	color: red;
	font-size: 150%;
	height: 40px;
	font-weight: 700;
	display: block;
	float: left;
	padding-top: 10px;
	padding-left: 10px;
}

span.hidden {
	display:none;
	float: left;
}

.spanDTime{
	height: 40px;
	font-weight: 700;
	display: block;
	float: left;
	padding-top: 10px;
	padding-left: 10px;
	display: none
	
}



    </style>
</head>
<body>

<!--第一部分-->
<div>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="collapse navbar-collapse" style="width: 90%">
                <ul class="nav navbar-nav list">
                    <li><a href="">洗钱风险分类</a></li>
                    <li><a href="">涉敏管理</a></li>
                </ul>
            </div>
        </div>
    </nav>
</div>

<!--第二部分-->
<div class="middleMenu">
    <ul>
        <li><a href="#">公告通知</a></li>
        <li><a href="#">我的任务</a></li>
        <li><a href="#">我的关注</a></li>
        <li><a href="#">我的实体</a></li>
        <li><a href="#">我的推荐</a></li>
        <li><a href="#">现场办公</a></li>
    </ul>
</div>

<!--第三部分-->
<div class="btns-group">
    <!-- Single button -->
    <div class="btn-group">
        <button id="ajaxBtn2" type="button" class="btn btn-default "  aria-haspopup="true" aria-expanded="false">
            <span class="glyphicon glyphicon-saved" aria-hidden="true"></span>保存
        </button>
    </div>

    <div class="btn-group">
        <button type="button" class="btn btn-default "  aria-haspopup="true" aria-expanded="false">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>资料清单
        </button>
    </div>

    <div class="btn-group">
        <button type="button" class="btn btn-default">审批流程</button>
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span class="caret"></span>
            <span class="sr-only">Toggle Dropdown</span>
        </button>
        <ul class="dropdown-menu">
            <li><a href="#">Action</a></li>
            <li><a href="#">Another action</a></li>
            <li><a href="#">Something else here</a></li>
        </ul>
    </div>
</div>

<!--第四部分-->

<div class="panel panel-default" style="width: 99% ; margin: auto" >
    <div class="panel-heading">基本信息</div>
    <div class="panel-body" >

        <div class="row2 ">
            <span class="sp">客户全称</span>
            <input type="text" name="fullName" placeholder="xxxx" class="form-control inp" style="background-color: #eae9e9">
            <span class="errorMsg1">*</span>
        </div>

        <div class="row2 ">
            <span class="sp">客户简称</span>
            <input type="text" name="singleName" placeholder="xxxx" class="form-control inp" style="background-color: #eae9e9">
            <span class="errorMsg2">*</span>
        </div>


        <div class="row2">
            <span class="sp">项目名称</span>
            <input type="text" name="programeName" placeholder="xxxx" class="form-control inp" style="background-color: #eae9e9">
        </div>
        <div class="row2">
            <span class="sp">业务场景</span>
            <select id="service1" name="service" class="form-control inp" style="color: #999999">
                <option>请选择</option>
                <option>尽职调查</option>
                <option>租期检查</option>
                <option>签约现场</option>
                <option>投标现场</option>
                <option>拍卖现场</option>
                <option>其他</option>
            </select>
            <span class="errorMsg3">*</span>
        </div>

        <div class="row2">
            <span class="sp">工作类型</span>
            <select id="workType" name="jobKind" class="form-control inp" style="color: #999999">
                <option>请选择</option>
            </select>
            <span class="errorMsg4">*</span>
        </div>
        <div class="row2">
            <span class="sp" style="padding-left: 28px">地点</span>
            <input  type="text" name="place" placeholder="xxxx" class="form-control inp">
        </div>

        <div class="row2">
            <span class="sp">开始日期</span>
            <input id="startTime" type="date" name="startTime" placeholder="xxxx" class="form-control inp">
        </div>
        <div class="row2">
            <span class="sp">结束时间</span>
            <input id="endTime" type="date" name="endTime" placeholder="xxxx" class="form-control inp">
            <span class="errorMsg6"></span>
        </div>

        <div class="row2">
            <span class="sp" style="padding-left: 28px">说明</span>
            <textarea name="instruction" class="form-control inp" style="height: 50px"></textarea>
        </div>

    </div>
</div>

<br/>

<!--第五部分-->
<div class="panel panel-default" style="width: 99% ; margin: auto" >
    <div class="panel-heading">人员信息</div>
    <div id="allContentBody" class="panel-body" >

        <!--按钮部分-->
        <div class="btns-group">
            <!-- Single button -->
            <div class="btn-group">
                <button id="addButton" type="button" class="btn btn-default "  aria-haspopup="true" aria-expanded="false">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>添加
                </button>
            </div>

            <div class="btn-group">
                <button id="deleteButton" type="button" class="btn btn-default "  aria-haspopup="true" aria-expanded="false">
                    <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>删除
                </button>
            </div>
        </div>
    </div>
</div>

<br/>

<!--第六部分-->
<div class="panel panel-default" style="width: 99%;margin: auto">

    <div class="panel-heading">
        <span id="minus" class="glyphicon glyphicon-minus">调查内容</span>
    </div>

    <div id="hide1" style="display: block;">
        <div class="panel-body" style="margin-left: 10%;">
                <span style="float:left;width: 50%">
                    <span style="float:left;width: 14%">
                        <b>目标</b><br>
                        <b>(起因)</b>
                    </span>
                    <span style="float:left;width: 86%">
                        <textarea name="target" class="form-control" style="width: 1000px;height: 100px; display: inline;"
                                  placeholder="输入现场办公目标，即出差目的：如项目营销、尽职调查、权属确认（办理）、抵质押办理（调查）等等。"></textarea>
                    </span>
                </span><br>
            </span>
        </div>

        <div class="panel-body" style="margin-left: 10%;">
                <span style="float:left;width: 50%">
                    <span style="float:left;width: 14%">
                        <b>内容</b><br>
                        <b>(经过)</b>
                    </span>
                    <span style="float:left;width: 86%">
                        <textarea name="content" class="form-control" style="width: 1000px;height: 100px; display: inline;"
                                  placeholder="输入现场办公的工作具体（或大致）内容，如谈判概况、信用风险或实物资产风险调查概况，抵质押物的检查或办理等（如适用）。"></textarea>
                    </span>
                </span><br>
            </span>
        </div>

        <div class="panel-body" style="margin-left: 10%;">
                <span style="float:left;width: 50%">
                    <span style="float:left;width: 14%">
                        <b>效果</b><br>
                        <b>(结果)</b>
                    </span>
                    <span style="float:left;width: 86%">
                        <textarea name="effect" class="form-control" style="width: 1000px;height: 100px; display: inline;"
                                  placeholder="现场办公的阶段性成果，以及难点和下一步工作计划。"></textarea>
                    </span>
                </span><br>
            </span>
        </div>
    </div>
</div>



<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="../js/jquery-3.5.1.min.js" th:src="@{/js/jquery-3.5.1.min.js}"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script src="../js/bootstrap.min.js" th:src="@{/js/bootstrap.min.js}"></script>
<script src="../js/bootstrap-table.min.js" th:src="@{/js/bootstrap-table.min.js}"></script>
<!-- 汉化文件 after bootstrap-table.js -->
<script src="../js/bootstrap-table-zh-CN.js" th:src="@{/js/bootstrap-table-zh-CN.js}"></script>
</body>

<script>

    $(function () {
    	//获取url携带的参数---->客户id值
    	var searchURL = window.location.search;
    	searchURL = searchURL.substring(1);
    	//根据传递过来的id值发送请求将该记录的信息反馈到编辑页面上等待管理员进行修改
     	$.ajax({
    		url: "squery",
    		type: "GET",
    		data:searchURL,
    		success: function(data){
    			 console.log(data); 
    			$("input[name=fullName]").val(data.customer.fullName);
     			$("input[name=singleName]").val(data.customer.singleName);
    			$("input[name=programeName]").val(data.customer.programeName); 
    			if(data.customer.service == "" || data.customer.service == null){
    				$("#service1").val("请选择");
    			}else {
    				$("#service1").val(data.customer.service);
    			}
    			if(data.customer.service == "尽职调查") {
                	$("<option>项目营销</option>").appendTo($("#workType")),
                    $("<option>正式调查</option>").appendTo($("#workType")),
                    $("<option>权属办理</option>").appendTo($("#workType")),
                    $("<option>押品办理</option>").appendTo($("#workType")),
                    $("<option>其他</option>").appendTo($("#workType"))
    			}
    			if(data.customer.jobKind == "" || data.customer.jobKind == null) {
    				$("#workType").val("请选择");
    			}else {
    				$("#workType").val(data.customer.jobKind);
    			}
    			$("input[name=place]").val(data.customer.place);
    			$("input[name=startTime]").val(data.customer.startTime);
    			$("input[name=endTime]").val(data.customer.endTime);
    			$("textarea[name=instruction]").val(data.customer.instruction);
 		 //====================================================================================//
    			var len = data.principal.length+data.custpeople.length+data.partprincipal.length;
    			/* console.log(len); */
    			//根据客户的各种参与者的数量设计块的数量
    			for(var i = 0;i < len;i++) {
    				$("        <div class=\"panel panel-default allContent\" style=\"width: 99% \" >" +
    		                "            <input type=\"checkbox\" style=\"float: left\">" +
    		                "            <div class=\"panel-body partContent\" >" +
    		                "                <div class=\"row2\">" +
    		                "                    <span class=\"sp\">类型</span>" +
    		                "                    <select name=\"peoplekind\" class=\"form-control inp\" style=\"color: #999999\">" +
    		                "                        <option>请选择</option>" +
    		                "                        <option>我司人员</option>" +
    		                "                        <option>客户人员</option>" +
    		                "                        <option>分行人员</option>" +
    		                "                        <option>第三方人员</option>" +
    		                "                        <option>其他人员</option>" +
    		                "                    </select>" +
    		                "                <span class=\"spanAttention\">*</span>" +
    		                "                </div>" +
    		                "" +
    		                "                <div class=\"row2 name\">" +
    		                "                    <span class=\"sp\" style=\"padding-left: 28px\">姓名</span>" +
    		                "                    <input type=\"text\" name=\"peoplename\" placeholder=\"xxxx\" class=\"form-control inp\" style=\"background-color: #eae9e9\">" +
    		                "                <span class=\"spanAttention\">*</span>" +
    		                " 				 <span class=\"spanDTime\">0</span>" +
    		                "                </div>" +
    		                "               <span name=\"id\" class=\"hidden\"></span>"  +
    		                "            </div>" +
    		                "        </div>").appendTo($("#allContentBody"));
    			}
    			//通过array数组来存放所有员工的对象，再利用sort()方法对其进行排序
    			var array = [];
    			for(var i = 0;i < data.principal.length;i++){
    				array.push(data.principal[i])
    			}
    			
    			for(var i = 0;i < data.partprincipal.length;i++){
    				array.push(data.partprincipal[i])
    			}
    			
    			for(var i = 0;i < data.custpeople.length;i++){
    				array.push(data.custpeople[i])
    			}
    			//对象数组比较升序排序
    			array.sort((a,b)=>{return a.level-b.level});  	
    			console.log(array);
     			for(var i = 0;i<array.length;i++) {
    				if(Object.keys(array[i])[0]==Object.keys(data.principal[0])[0]) {
    					$("#allContentBody select[name=peoplekind]").eq(i).val("我司人员");
    					$("#allContentBody input[name=peoplename]").eq(i).val(array[i].pname);
    					$("span.hidden").eq(i).text(array[i].pid);
    					$("                <div class=\"row2 \">" +
    	                        "                    <span class=\"sp\" >部门</span>" +
    	                        "                    <input type=\"text\" name=\"dname\" placeholder=\"xxxx\" class=\"form-control inp\" style=\"background-color: #eae9e9\">" +
    	                        "                </div>" +
    	                        "" +
    	                        "                <div class=\"row2\">" +
    	                        "                    <span class=\"sp\">调查身份</span>" +
    	                        "                    <select name=\"identity\" class=\"form-control inp\" style=\"color: #999999\">" +
    	                        "                        <option>请选择</option>" +
    	                        "                        <option>第一调查人</option>" +
    	                        "                        <option>第二调查人</option>" +
    	                        "                        <option>其他调查人</option>" +
    	                        "                    </select>" +
    	                        "                <span class=\"spanAttention\">*</span>" +
    	                        "                </div>").appendTo($(".partContent").eq(i));
    					$(".allContent").eq(i).find("input[name=dname]").val(array[i].dname);
    					$(".allContent").eq(i).find("select[name=identity]").val(array[i].identity);
    				}else if(Object.keys(array[i])[0]==Object.keys(data.custpeople[0])[0]){
    					$("#allContentBody select[name=peoplekind]").eq(i).val("客户人员");
    					$("#allContentBody input[name=peoplename]").eq(i).val(array[i].cpname);
    					$("span.hidden").eq(i).text(array[i].cpid);
    					$("                <div class=\"row2 \">" +
    	                        "                    <span class=\"sp\">职务</span>" +
    	                        "                    <input type=\"text\" name=\"cpduty\" placeholder=\"xxxx\" class=\"form-control inp\" >" +
    	                        "                </div>" +
    	                        "" +
    	                        "                <div class=\"row2\">" +
    	                        "                    <span class=\"sp\">联系方式</span>" +
    	                        "                    <input id=\"cpMobile\" type=\"text\" name=\"cpMobile\" placeholder=\"xxxx\" class=\"form-control inp\" >" +
    	                        "<span class=\"spanAttention1\"></span>" +
    	                        "                </div>").appendTo($(".partContent").eq(i));
    					$(".allContent").eq(i).find("input[name=cpduty]").val(array[i].duty);    					
    					$(".allContent").eq(i).find("input[name=cpMobile]").val(array[i].mobile);
    				}else if(Object.keys(array[i])[0]==Object.keys(data.partprincipal[0])[0]){
    					$("#allContentBody select[name=peoplekind]").eq(i).val("分行人员");
    					$("#allContentBody input[name=peoplename]").eq(i).val(array[i].ppname);
    					$("span.hidden").eq(i).text(array[i].ppid);
    					$("                <div class=\"rw\">" +
    	                        "                    <span class=\"sp\" >机构名称</span>" +
    	                        "                    <input type=\"text\" name=\"organization\" placeholder=\"xxxx\" class=\"form-control inp\" style=\"background-color: #eae9e9\">" +
    	                        "                </div>                " +
    	                        "                <div class=\"dt\">" +
    	                        "                    <span class=\"sp\" >职务</span>" +
    	                        "                    <input type=\"text\" name=\"duty\" placeholder=\"xxxx\" class=\"form-control inp\">" +
    	                        "                </div>                " +
    	                        "                 <div class=\"rw\">" +
    	                        "                    <span class=\"sp\" >联系方式</span>" +
    	                        "                    <input id=\"ppMobile\" type=\"text\" name=\"Mobile\" placeholder=\"xxxx\" class=\"form-control inp\">" +
    	                        "              		  <span class=\"spanAttention1\"></span>" +
    	                        "                </div>").appendTo($(".partContent").eq(i));
    					$(".allContent").eq(i).find("input[name=organization]").val(array[i].organization);
    					$(".allContent").eq(i).find("input[name=duty]").val(array[i].duty);
    					$(".allContent").eq(i).find("input[name=Mobile]").val(array[i].ppMobile);
    				}
    			} 
    			$("textarea[name=target]").val(data.customer.target);
    			$("textarea[name=content]").val(data.customer.content);
    			$("textarea[name=effect]").val(data.customer.effect)  
    			
    		},
    		dataType: "json",
    		
    	}) 
//----------------------------------------------------------------------------------------------------------------------//
		//两个下拉框进行联动
        $('#service1').click(function () {
            if ($('#service1 option:selected').val() == '尽职调查' && $('#workType > option').length < 2) {
                	$("<option>项目营销</option>").appendTo($('#workType')),
                    $("<option>正式调查</option>").appendTo($('#workType')),
                    $("<option>权属办理</option>").appendTo($('#workType')),
                    $("<option>押品办理</option>").appendTo($('#workType')),
                    $("<option>其他</option>").appendTo($('#workType'))
            }else {
                $("#workType option:contains('项目营销')").remove(),
                    $("#workType option:contains('正式调查')").remove(),
                    $("#workType option:contains('权属办理')").remove(),
                    $("#workType option:contains('押品办理')").remove(),
                    $("#workType option:contains('其他')").remove()
            }
        })
//----------------------------------------------------------------------------------------------------------------------//
        //下拉列表选择不同类型职员出现不同的操作函数
        var kindFunction = function () {
            // console.log( $(this).parent().parent().children(".name"))
            if ($(this).children(":selected").val() == "我司人员") {
                $(this).parent().parent().children(".name").nextAll().remove(),
                    $("                <div class=\"row2 \">" +
                        "                    <span class=\"sp\" >部门</span>" +
                        "                    <input type=\"text\" name=\"dname\" placeholder=\"xxxx\" class=\"form-control inp\" style=\"background-color: #eae9e9\">" +
                        "                </div>" +
                        "" +
                        "                <div class=\"row2\">" +
                        "                    <span class=\"sp\">调查身份</span>" +
                        "                    <select name=\"identity\" class=\"form-control inp\" style=\"color: #999999\">" +
                        "                        <option>请选择</option>" +
                        "                        <option>第一调查人</option>" +
                        "                        <option>第二调查人</option>" +
                        "                        <option>其他调查人</option>" +
                        "                    </select>" +
                        "                <span class=\"spanAttention\">*</span>" +
                        "                </div>").appendTo($(this).parent().parent())
            }else if($(this).children(":selected").val() == "客户人员" ) {
                //添加前，若先选择其他下拉项，会先出现其对应的情况，当再次点击正确下拉项前需要将之前添加的情况删除
                $(this).parent().parent().children(".name").nextAll().remove(),
                    $("                <div class=\"row2 \">" +
                        "                    <span class=\"sp\">职务</span>" +
                        "                    <input type=\"text\" name=\"cpduty\" placeholder=\"xxxx\" class=\"form-control inp\" >" +
                        "                </div>" +
                        "" +
                        "                <div class=\"row2\">" +
                        "                    <span class=\"sp\">联系方式</span>" +
                        "                    <input type=\"text\" name=\"cpMobile\" placeholder=\"xxxx\" class=\"form-control inp\" >" +
                        "<span class=\"spanAttention1\"></span>" +
                        "                </div>").appendTo($(this).parent().parent())
            }else if ($(this).children(":selected").val() == "分行人员") {
                $(this).parent().parent().children(".name").nextAll().remove(),
                    $("                <div class=\"rw\">" +
                        "                    <span class=\"sp\" >机构名称</span>" +
                        "                    <input type=\"text\" name=\"organization\" placeholder=\"xxxx\" class=\"form-control inp\" style=\"background-color: #eae9e9\">" +
                        "                </div>                " +
                        "                <div class=\"dt\">" +
                        "                    <span class=\"sp\" >职务</span>" +
                        "                    <input type=\"text\" name=\"duty\" placeholder=\"xxxx\" class=\"form-control inp\">" +
                        "                </div>                " +
                        "                 <div class=\"rw\">" +
                        "                    <span class=\"sp\" >联系方式</span>" +
                        "                    <input type=\"text\" name=\"Mobile\" placeholder=\"xxxx\" class=\"form-control inp\">" +
                        "<span class=\"spanAttention1\"></span>" +
                        "                </div>").appendTo($(this).parent().parent())
            }
        }
//----------------------------------------------------------------------------------------------------------------------//
        //添加事件点击函数
        $('#addButton').click(function () {
            var $obj = $("        <div class=\"panel panel-default allContent\" style=\"width: 99% \" >" +
                "            <input type=\"checkbox\" style=\"float: left\">" +
                "            <div class=\"panel-body partContent\" >" +
                "                <div class=\"row2\">" +
                "                    <span class=\"sp\">类型</span>" +
                "                    <select name=\"peoplekind\" class=\"form-control inp\" style=\"color: #999999\">" +
                "                        <option>请选择</option>" +
                "                        <option>我司人员</option>" +
                "                        <option>客户人员</option>" +
                "                        <option>分行人员</option>" +
                "                        <option>第三方人员</option>" +
                "                        <option>其他人员</option>" +
                "                    </select>" +
                "                <span class=\"spanAttention\">*</span>" +
                "                </div>" +
                "" +
                "                <div class=\"row2 name\">" +
                "                    <span class=\"sp\" style=\"padding-left: 28px\">姓名</span>" +
                "                    <input type=\"text\" name=\"peoplename\" placeholder=\"xxxx\" class=\"form-control inp\" style=\"background-color: #eae9e9\">" +
                "                <span class=\"spanAttention\">*</span>" +
                "<span class=\"spanDTime\">0</span>"  +
                "                </div>" +
                "               <span name=\"id\" class=\"hidden\"></span>"  +
                "            </div>" +
                "        </div>");
            $obj.appendTo($("#allContentBody"));
            var index = $("select").length
            // alert(index)
            var $eqElement = $("select").eq(index-1); //获取新添加模块中的下拉列表select,注意索引是从0开始
            //添加一个新的模块后再次对下拉选项进行绑定单击事件
            $eqElement.click(function() {
				for(var i = 0;i<$(".allContent").length;i++) {
					$("span.spanDTime").eq(i).text(i);
				}
				if ($(this).children(":selected").val() == "我司人员") {
					$(this).parent().parent().children(".name").nextAll().remove(),
					$(
							"                <div class=\"row2 \">"
									+ "                    <span class=\"sp\" >部门</span>"
									+ "                    <input type=\"text\" name=\"dname\" placeholder=\"xxxx\" class=\"form-control inp dept\" style=\"background-color: #eae9e9\">"
									+ "                </div>"
									+ ""
									+ "                <div class=\"row2\">"
									+ "                    <span class=\"sp\">调查身份</span>"
									+ "                    <select name=\"identity\" class=\"form-control inp\" style=\"color: #999999\">"
									+ "                        <option>请选择</option>"
									+ "                        <option>第一调查人</option>"
									+ "                        <option>第二调查人</option>"
									+ "                        <option>其他调查人</option>"
									+ "                    </select>"
									+ "<span class=\"spanAttention\">*</span>"
									+ "                </div>").appendTo($(this).parent().parent());
		} else if ($(this).children(":selected").val() == "客户人员") {
					//添加前，若先选择其他下拉项，会先出现其对应的情况，当再次点击正确下拉项前需要将之前添加的情况删除
					$(this).parent().parent().children(".name").nextAll().remove(),
					$(
							"                <div class=\"row2 \">"
									+ "                    <span class=\"sp\">职务</span>"
									+ "                    <input type=\"text\" name=\"cpduty\" placeholder=\"xxxx\" class=\"form-control inp\" >"
									+ "                </div>"
									+ ""
									+ "                <div class=\"row2\">"
									+ "                    <span class=\"sp\">联系方式</span>"
									+ "                    <input id=\"cpMobile\"  type=\"text\" name=\"cpMobile\" placeholder=\"xxxx\" class=\"form-control inp cphone\" >"
									+ "<span class=\"spanAttention1\"></span>"
									+ "                </div>").appendTo($(this).parent().parent())
		} else if ($(this).children(":selected").val() == "分行人员") {
					$(this).parent().parent().children(".name").nextAll().remove(),
					$(
							"                <div class=\"rw\">"
									+ "                    <span class=\"sp\" >机构名称</span>"
									+ "                    <input type=\"text\" name=\"organization\" placeholder=\"xxxx\" class=\"form-control inp\" style=\"background-color: #eae9e9\">"
									+ "                </div>                "
									+ "                <div class=\"dt\">"
									+ "                    <span class=\"sp\" >职务</span>"
									+ "                    <input type=\"text\" name=\"ppduty\" placeholder=\"xxxx\" class=\"form-control inp\">"
									+ "                </div>                "
									+ "                 <div class=\"rw\">"
									+ "                    <span class=\"sp\" >联系方式</span>"
									+ "                    <input id=\"ppMobile\" type=\"text\" name=\"ppMobile\" placeholder=\"xxxx\" class=\"form-control inp pphone\">"
									+ "<span class=\"spanAttention1\"></span>"
									+ "                </div>").appendTo($(this).parent().parent())
		}
			});
        });
//----------------------------------------------------------------------------------------------------------------------//
        //下拉选项进行绑定事件
        $("#jobKind1").click(kindFunction);
//----------------------------------------------------------------------------------------------------------------------//

        $("#minus").click(function () {
            $("#hide1").toggle()
        })
//-----------------------------------------------------------------------------------------------------------------------//
  
//----------------------------------------------------------------------------------------------------------------------//

        //验证客户的部分内容是否为空
        function testNNull(len) {
         	flag = 1;
          	$("span.errorMsg1").text("");
            //客户的部分输入框只要为空就不发送ajax请求-------进行校正
            if($("input[name=fullName]").val() == "") {
     		  $("span.errorMsg1").text("客户全名不能为空!");
     		  $("span.errorMsg1").css("font-size","100%");
     		   flag = 0;
            }
            
            $("span.errorMsg2").text("");
            if($("input[name=singleName]").val() == "") {
         	  $("span.errorMsg2").text("客户简称不能为空!"); 
         	  $("span.errorMsg2").css("font-size","100%");
         	   flag = 0;
            }
            
            $("span.errorMsg3").text("");
            if(($("#service1").val()=="请选择"?'':$("#service1").val()) == "") {
         	  $("span.errorMsg3").text("请选择合理的业务场景!");
         	  $("span.errorMsg3").css("font-size","100%");
         	   flag = 0;
            }
            
            $("span.errorMsg4").text("");
            if($("#service1").val()=="请选择") {
         	  $("span.errorMsg4").text("请选择合理的工作类型!");
         	  $("span.errorMsg4").css("font-size","100%");
         	   flag = 0;
         	   if( $("#workType").val()=="请选择") {
              	  $("span.errorMsg4").text("请选择合理的工作类型!");
             	  $("span.errorMsg4").css("font-size","100%");
             	   flag = 0;
         	   }
            }else if($("#service1").val() == "尽职调查" && $("#workType").val()=="请选择") {
         	  $("span.errorMsg4").text("请选择合理的工作类型!");
         	  $("span.errorMsg4").css("font-size","100%");
         	   flag = 0;
            }
            
            
            $(".allContent").eq(i).find("span[class=spanAttention]").text("");
            for(var i = 0;i < len;i++) {
            	if($(".allContent").eq(i).find("select[name=peoplekind] option:selected").val() == "请选择"){
          		 	$(".allContent").eq(i).find("span[class=spanAttention]").text("请选择合理的工作人员!");
          		 	$(".allContent").eq(i).find("span[class=spanAttention]").css("font-size","100%");
          		 	flag = 0;
          		 }
            }   
           return flag;
        }
       

        
        //给验证内容绑定事件，当不为空[只要输入内容]，警告消息就消失 
        $("input[name=fullName]").keyup(function() {
        	if($("input[name=fullName]").val() == ""){
        		$("span.errorMsg1").text("*");
        		$("span.errorMsg1").css({"font-size":"150%"});
        	}else {
        		$("span.errorMsg1").text("");
        	}
        })
        
       $("input[name=singleName]").keyup(function() {
    	   if($("input[name=singleName]").val() == "") {
    		   $("span.errorMsg2").text("*");
    		   $("span.errorMsg2").css({"font-size":"150%"});
    	   }else {
    		   $("span.errorMsg2").text("");
    	   }
        })
        
       function select() {
       		if($("#service1").val() == "尽职调查" && $("#workType").val() == "请选择") {
       			$("span.errorMsg3").text("");
       			$("span.errorMsg4").text("*");
       			$("span.errorMsg4").css("font-size","150%");
       		}else if($("#service1").val() == "尽职调查" && $("#workType").val() != "请选择"){
           	  $("span.errorMsg3").text("");
           	  $("span.errorMsg4").text("");
       		}else if($("#service1").val() != "尽职调查" && $("#service1").val() != "请选择" && $("#workType").val() == "请选择") {
             	  $("span.errorMsg3").text("");
               	  $("span.errorMsg4").text("");
       		}else {
       			$("span.errorMsg3").text("*");
       			$("span.errorMsg3").css("font-size","150%");
       		 	$("span.errorMsg4").text("*");
       		 	$("span.errorMsg4").css("font-size","150%");
       		}	
        }
        $("#service1").change(select);
        $("#workType").change(select);        
//---------------------------------------------------------------------------------------------------------------------//
		// 结束时间要大于开始日期验证  && 开始日期要大于当前时间
		var date = new Date();
		var year = date.getFullYear();
		var month = date.getMonth() + 1;
		if (month < 10) {
			month = '0' + month;
		}
		var day = date.getDate();
		if (day < 10) {
			day = '0' + day;
		}
		var time = year + '-' + month + '-' + day;
		$("#startTime").attr("min", time);

		$("#startTime").change(function() {
			var year = $("#startTime").val().split("-")[0];

			var month = $("#startTime").val().split("-")[1];

			var day = $("#startTime").val().split("-")[2];
			if (parseInt(day) < 10) {
				day = '0' + (parseInt(day) + 1);
			} else {
				day = parseInt(day) + 1;
			}
			time1 = year + "-" + month + '-' + day;
			$("#endTime").attr("min", time1);
		})

		$("#endTime").change(function() {
			if ($("#startTime").val() == "") {
				$("span.errorMsg6").text("请先选择开始日期!").fadeOut(2000);
				$("span.errorMsg6").css("font-size", "100%");
				$("#endTime").val("");
			}
		})

      	// 时间字符串转时间函数
       function getDate(dateStr) {
        	return new Date(Date.parse(dateStr.replace(/-/g, "/")));
		}
   
//---------------------------------------------------------------------------------------------------------------------//
	//删除按钮对客户的工作人员进行删除
	$("#deleteButton").on("click",function() {
		var len =  $(".allContent").length; 
		var ppid = [];
		var cpid = [];
		var pid = [];
		
		for(var i = 0;i < len;i++) {
			if($(".allContent").eq(i).find("input[type=checkbox]").is(":checked")  && $(".allContent").eq(i).find("select[name=peoplekind]").val() == "我司人员" ) {
				pid.push($(".allContent").eq(i).find("span.hidden").text());
			}else if($(".allContent").eq(i).find("input[type=checkbox]").is(":checked") && $(".allContent").eq(i).find("select[name=peoplekind]").val() == "客户人员") {
				cpid.push($(".allContent").eq(i).find("span.hidden").text());
			}else if($(".allContent").eq(i).find("input[type=checkbox]").is(":checked") && $(".allContent").eq(i).find("select[name=peoplekind]").val() == "分行人员") {
				ppid.push($(".allContent").eq(i).find("span.hidden").text());
			} 
		}
		var id = {
			"pid": pid,
			"cpid": cpid,
			"ppid": ppid
		}
		
		/* console.log(id); */
		var bool = confirm("你是否要删除?");
		if(bool) {
			$('.allContent').has($("input[type=checkbox]:checked")).remove()
			// $('.all-content').has(":checkbox:checked").remove()   该方法虽然也行，不过:checkbox匹配所有选中的单选，复选，和下拉列表中选中的 option 标签对象
			$.ajax({
				url:"deleteEmp",
				data:JSON.stringify(id),
				type:"POST",
				success:function(data) {
					if("success" == data) {
						alert("删除成功!")
					}
				},
     			contentType:"application/json;charset=utf-8",
     			dataType:"text" 
				
			})
		}
	})

//--------------------------------------------------------------------------------------------------------------------//
        /**
        *使用momentjs组件对开始日期和结束日期进行格式化
        **/
        $("#ajaxBtn2").click(function () {
        var cid = searchURL.split("=")[1];  
        var fullName = $("input[name=fullName]").val();
        var singleName = $("input[name=singleName]").val();
        var programeName = $("input[name=programeName]").val();
       //业务场景
       var service = $("#service1").val();
       //工作类型
       var jobKind = $("#workType").val();
       var place = $("input[name=place]").val();
       var startTime = $("input[name=startTime]").val();
       var endTime = $("input[name=endTime]").val();
       var instruction = $("textarea[name=instruction]").val();
       var target = $("textarea[name=target]").val();
       var content = $("textarea[name=content]").val();
       var effect = $("textarea[name=effect]").val();

     	var customer = {
     		"cid":cid,//对比dao层有id值且与session有关，属于持久态，会自动更新
        	"fullName":fullName,
        	"singleName":singleName,
        	"programeName":programeName,
        	"service":service == '请选择'?'':service,
        	"jobKind":jobKind == '请选择'?'':jobKind, 
        	"phase":"执行中",
        	"place":place,
        	"admin":"张杰",
        	"department":"交通金融部门",
        	"startTime":startTime,
        	"endTime":endTime,
        	"instruction":instruction,
        	"target":target,
        	"content":content,
        	"effect":effect
        }
      /*  console.log(customer); */
      
       var len =  $(".allContent").length;
       var principal = new Array();
	   var custpeople = new Array();
	   var partprincipal = new Array();
	   var dept = new Array();
      	  for(var i = 0;i < len;i++) {
      		/* $("select").eq(index-1) */
      		/* alert($(".allContent").eq(i).find("select[name=peoplekind] option:selected").val()); */
    	   if($(".allContent").eq(i).find("select[name=peoplekind]").val() == "我司人员") {
    		   principal.push({
    			   "pid":$(".allContent").eq(i).find("span[class=hidden]").text(),
    			   "pname":$(".allContent").eq(i).find("input[name=peoplename]").val(),
    			   "identity":$(".allContent").eq(i).find("select[name=identity] option:selected").val(),
    			   "dname":$(".allContent").eq(i).find("input[name=dname]").val(),
    			   "level":$(".allContent").eq(i).find("span.spanDTime").text()
    			   })
    	   }else if($(".allContent").eq(i).find("select[name=peoplekind]").val() == "客户人员"){
    		   custpeople.push({
    			   "cpid":$(".allContent").eq(i).find("span[class=hidden]").text(),
    			   "cpname":$(".allContent").eq(i).find("input[name=peoplename]").val(),
    			   "duty":$(".allContent").eq(i).find("input[name=cpduty]").val(),
    			   "mobile":$(".allContent").eq(i).find("input[name=cpMobile]").val(),
    			   "level":$(".allContent").eq(i).find("span.spanDTime").text()
    		   		})
    	   }else if($(".allContent").eq(i).find("select[name=peoplekind]").val() == "分行人员"){
    		   partprincipal.push({
    			   "ppid":$(".allContent").eq(i).find("span[class=hidden]").text(),
    			   "ppname":$(".allContent").eq(i).find("input[name=peoplename]").val(),
    			   "organization":$(".allContent").eq(i).find("input[name=organization]").val(),
    			   "duty":$(".allContent").eq(i).find("input[name=duty]").val(),
    			   "ppMobile":$(".allContent").eq(i).find("input[name=Mobile]").val(),
    			   "level":$(".allContent").eq(i).find("span.spanDTime").text()
    		   })
    	   }
       }

       	   var arr = {
       			    "customer":customer,
        			"principal":principal,
        			"custpeople":custpeople,
        			"partprincipal":partprincipal,
        			}
       	          
 		console.log(arr); 
         if(testNNull(len) == 1){
        	 var bol = confirm("确定要保存吗?");
        	 if(bol) {
           		 $.ajax({
          			url:"update",
          	    	data:JSON.stringify(arr),  
          			type:"POST",
          			success:function(data) {
          				if("success" == data){
          					$(location).attr("href","query.html");
          				} 
          			},
          			contentType:"application/json;charset=utf-8",
          			dataType:"text" 
          		}) 
        	 }
       }  
        })
    })


</script>
</html>